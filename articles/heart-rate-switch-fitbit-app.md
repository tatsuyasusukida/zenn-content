---
title: "å¿ƒæ‹ã‚¹ã‚¤ãƒƒãƒFitbitã‚¢ãƒ—ãƒªã‚’ãƒªãƒªãƒ¼ã‚¹ã—ã¾ã—ãŸ"
emoji: "ğŸ’—"
type: "tech"
topics: ["fitbit", "javascript", "ifttt", "iot"]
published: true
---

## ã¯ã˜ã‚ã«

å…ˆæœˆã®2022å¹´11æœˆ15æ—¥(ç«)ã«Heart Rate Switchï¼ˆå¿ƒæ‹ã‚¹ã‚¤ãƒƒãƒï¼‰ã¨ã„ã†åå‰ã§Fitbitã‚¢ãƒ—ãƒªã‚’ãƒªãƒªãƒ¼ã‚¹ã—ã¾ã—ãŸã€‚Fitbit Galleryã«ç„¡æ–™ã‚¢ãƒ—ãƒªã¨ã—ã¦ç™»éŒ²ã—ã¦ãŠã‚Šã€ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã‹ã‚‰ä¸‹è¨˜ã®ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¯èƒ½ã§ã™ã€‚

https://gallery.fitbit.com/details/989e530e-c44d-448d-8afe-653f4c59a179

ã‚¢ãƒ—ãƒªã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã«ã¤ã„ã¦ã¯GitHubã§å…¬é–‹ã—ã¦ãŠã‚Šã€MITãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã§åˆ©ç”¨å¯èƒ½ã§ã™ã€‚

https://github.com/tatsuyasusukida/heartrate-switch

ã“ã®è¨˜äº‹ã§ã¯ã‚¢ãƒ—ãƒªã®æ©Ÿèƒ½ã¨å®Ÿè£…ã«åˆ©ç”¨ã—ãŸAPIã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã™ã€‚



## ã‚¢ãƒ—ãƒªã®æ©Ÿèƒ½

### ã“ã®ã‚¢ãƒ—ãƒªã¯ä½•ã‹ï¼Ÿ

å¿ƒæ‹ã‚¹ã‚¤ãƒƒãƒã¯å¿ƒæ‹æ•°ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ãƒªãƒ©ãƒƒã‚¯ã‚¹å‚¾å‘ã‚’è©•ä¾¡ã—ã€ã‚¹ãƒˆãƒ¬ã‚¹ãŒé«˜ã„çŠ¶æ…‹ã«ãªã£ãŸæ™‚ã«HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹Fitbitã‚¢ãƒ—ãƒªã§ã™ã€‚[IFTTT](https://ifttt.com/)ã®ã‚ˆã†ãªIoTã‚µãƒ¼ãƒ“ã‚¹ã¨çµ„ã¿åˆã‚ã›ã¦ä½¿ã†ã“ã¨ã«ã‚ˆã‚Šã€ä¾‹ãˆã°ã‚¹ãƒˆãƒ¬ã‚¹ãŒé«˜ã„çŠ¶æ…‹ã«ãªã£ãŸæ™‚ã«ã‚¹ãƒãƒ¼ãƒˆã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã§éŸ³æ¥½ã‚’å†ç”Ÿã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```mermaid
flowchart LR
  Start(ã‚¢ãƒ—ãƒªèµ·å‹•)
  Relax[ãƒªãƒ©ãƒƒã‚¯ã‚¹å‚¾å‘ã‚’è©•ä¾¡]
  Stress{ã‚¹ãƒˆãƒ¬ã‚¹ãŒé«˜ã„?}
  Http[HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡]

  Start --> Relax
  Relax --> Stress
  Stress -->|Yes| Http
  Stress -->|No| Relax
```

### ãƒªãƒ©ãƒƒã‚¯ã‚¹å‚¾å‘ã®è©•ä¾¡

ãƒªãƒ©ãƒƒã‚¯ã‚¹å‚¾å‘ã®è©•ä¾¡ã«ã¯[å¿ƒé›»å›³RRé–“éš”ã®ãƒ­ãƒ¼ãƒ¬ãƒ³ãƒ„ãƒ—ãƒ­ãƒƒãƒˆã«ã‚ˆã‚‹å‰¯äº¤æ„Ÿç¥çµŒæ´»å‹•ã®ç°¡æ˜“æ¨å®šæ³•ã®é–‹ç™º](https://www.jstage.jst.go.jp/article/jje1965/43/4/43_4_185/_pdf)ã®è«–æ–‡ã‚’å‚è€ƒã«ã—ã¾ã—ãŸã€‚ãƒªãƒ©ãƒƒã‚¯ã‚¹å‚¾å‘ã‚’$M$ã€å¿ƒæ‹æ•°ãƒ‡ãƒ¼ã‚¿ã®ã‚µãƒ³ãƒ—ãƒ«æ•°ã‚’$N$ã€å¿ƒæ‹æ•°ãƒ‡ãƒ¼ã‚¿ã®ã‚µãƒ³ãƒ—ãƒ«ã‚’$h_1, h_2, ..., h_N$ã¨ã—ã¦æ¬¡ã®æ•°å¼ã‚’ä½¿ã£ã¦è©•ä¾¡ã—ã¦ã„ã¾ã™ã€‚

$$M = \sqrt{c_x^2 + c_y^2}$$

ã“ã“ã§$c_x = t_1 + t_2 + ... + t_{N-1}$ã€$c_y = t_2 + t_3 + ... + t_N$ã€$t_n = 60 / h_n$ã§ã™ã€‚

### è¨­å®š

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ä¸‹è¨˜5ç‚¹ã‚’è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

- å¿ƒæ‹æ•°ãƒ‡ãƒ¼ã‚¿ã®ä¿æŒæœŸé–“[ç§’]
- é«˜ãƒªãƒ©ãƒƒã‚¯ã‚¹çŠ¶æ…‹ã®é–¾å€¤ï½œ$T_H$
- ä½ãƒªãƒ©ãƒƒã‚¯ã‚¹çŠ¶æ…‹ã®é–¾å€¤ï½œ$T_L$
- ä½ãƒªãƒ©ãƒƒã‚¯ã‚¹çŠ¶æ…‹æ¤œå‡ºæ™‚ã®HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡ã®ON/OFF
- HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã®URL

![](/images/articles/heart-rate-switch-fitbit-app/about-01.png)

### çŠ¶æ…‹é·ç§»

ã“ã®ã‚¢ãƒ—ãƒªã¯ãƒªãƒ©ãƒƒã‚¯ã‚¹çŠ¶æ³$M$ã€é«˜ãƒªãƒ©ãƒƒã‚¯ã‚¹çŠ¶æ…‹ã®é–¾å€¤$T_H$ã€ä½ãƒªãƒ©ãƒƒã‚¯ã‚¹çŠ¶æ…‹ã®é–¾å€¤$T_L$ã‹ã‚‰ç¾åœ¨ã®çŠ¶æ…‹ãŒãƒªãƒ©ãƒƒã‚¯ã‚¹ã€ãƒãƒ¼ãƒãƒ«ã€ã‚¹ãƒˆãƒ¬ã‚¹ã®ã„ãšã‚Œã§ã‚ã‚‹ã‹ã‚’æ¬¡ã®åŸºæº–ã§åˆ¤å®šã—ã¾ã™ã€‚

- ã‚‚ã—$M \ge T_H$ãªã‚‰ã°ãƒªãƒ©ãƒƒã‚¯ã‚¹
- ã‚‚ã—$T_H \lt M \lt T_L$ãªã‚‰ã°ãƒãƒ¼ãƒãƒ«
- ã‚‚ã—$M \le T_L$ãªã‚‰ã°ã‚¹ãƒˆãƒ¬ã‚¹

```mermaid
flowchart LR
  C{M, T_H, T_Lã‚’æ¯”è¼ƒ}
  R((ãƒªãƒ©ãƒƒã‚¯ã‚¹))
  N((ãƒãƒ¼ãƒãƒ«))
  S((ã‚¹ãƒˆãƒ¬ã‚¹))

  C -->|MãŒT_Hä»¥ä¸Š| R
  C -->|MãŒT_Lã¨T_Hã®é–“| N
  C -->|MãŒT_Lä»¥ä¸‹| S
```

### HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã®é€ä¿¡

ç¾åœ¨ã®çŠ¶æ…‹ãŒãƒãƒ¼ãƒãƒ«ã‹ã‚‰ã‚¹ãƒˆãƒ¬ã‚¹ã«å¤‰ã‚ã£ãŸæ™‚ã€ä½ãƒªãƒ©ãƒƒã‚¯ã‚¹çŠ¶æ…‹ã‚’æ¤œå‡ºã—ã¦HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã™ã€‚HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã®é€ä¿¡ãŒçŸ­æ™‚é–“ã«ä½•åº¦ã‚‚è¡Œã‚ã‚Œã‚‹ã“ã¨ã‚’é˜²ããŸã‚ã€ä½ãƒªãƒ©ãƒƒã‚¯ã‚¹çŠ¶æ…‹ã‚’1å›æ¤œå‡ºã™ã‚‹ã¨ãã®å¾Œã®æ¤œå‡ºã‚’æŠ‘åˆ¶ã—ã¾ã™ã€‚ç¾åœ¨ã®çŠ¶æ…‹ãŒãƒãƒ¼ãƒãƒ«ã‹ã‚‰ãƒªãƒ©ãƒƒã‚¯ã‚¹ã«å¤‰ã‚ã£ãŸæ™‚ã€ä½ãƒªãƒ©ãƒƒã‚¯ã‚¹æ¤œå‡ºã®æŠ‘åˆ¶ã‚’è§£é™¤ã—ã¾ã™ã€‚

```mermaid
graph LR
  subgraph ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
    Disable[ä½ãƒªãƒ©ãƒƒã‚¯ã‚¹çŠ¶æ…‹ã®æ¤œå‡ºæŠ‘åˆ¶:OFF]
    Enable[ä½ãƒªãƒ©ãƒƒã‚¯ã‚¹çŠ¶æ…‹ã®æ¤œå‡ºæŠ‘åˆ¶:ON]
    Send[HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã®é€ä¿¡]
  end

  subgraph ç¾åœ¨ã®çŠ¶æ…‹
    Relax((ãƒªãƒ©ãƒƒã‚¯ã‚¹))
    Normal((ãƒãƒ¼ãƒãƒ«))
    Stress((ã‚¹ãƒˆãƒ¬ã‚¹))

    Relax -->|MãŒT_Hæœªæº€| Normal
    Normal -->|MãŒT_Hä»¥ä¸Š| Relax

    Normal -->|MãŒT_Lä»¥ä¸‹| Stress
    Stress -->|MãŒT_Lã‚ˆã‚Šå¤§ãã„| Normal
  end

  Relax --> Disable
  Stress --> Enable
  Stress --> Send
```

### ç”»é¢

ãƒ‡ãƒã‚¤ã‚¹ã®ç”»é¢ã«ã¯ä¸‹è¨˜7ç‚¹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

- ç¾åœ¨ã®ãƒªãƒ©ãƒƒã‚¯ã‚¹å‚¾å‘
- é«˜ãƒªãƒ©ãƒƒã‚¯ã‚¹çŠ¶æ…‹ã®é–¾å€¤
- å®šãƒªãƒ©ãƒƒã‚¯ã‚¹çŠ¶æ…‹ã®é–¾å€¤
- å¿ƒæ‹æ•°ãƒ‡ãƒ¼ã‚¿ã®ä¿æŒæœŸé–“
- ä½ãƒªãƒ©ãƒƒã‚¯ã‚¹æ¤œå‡ºæ™‚ã®HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡ã®ON/OFF
- ã‚¹ãƒˆãƒ¬ã‚¹çŠ¶æ…‹ã®æ¤œå‡ºå›æ•°

![](/images/articles/heart-rate-switch-fitbit-app/about-02.png)



## å®Ÿè£…ã«åˆ©ç”¨ã—ãŸAPI

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

Fitbitã‚¢ãƒ—ãƒªã®ã‚³ãƒ¼ãƒ‰ã¯ãƒ‡ãƒã‚¤ã‚¹å´ï¼ˆFitbitæœ¬ä½“ï¼‰ã¨ã‚³ãƒ³ãƒ‘ãƒ‹ã‚ªãƒ³å´ï¼ˆã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ï¼‰ã¨å¤§ãã2ã¤ã«åˆ†ã‘ã‚‰ã‚Œã€ãƒ‡ãƒã‚¤ã‚¹å´ã¨ã‚³ãƒ³ãƒ‘ãƒ‹ã‚ªãƒ³å´ã§ã¯åˆ©ç”¨ã§ãã‚‹APIãŒç•°ãªã‚Šã¾ã™ã€‚ä¸€ä¾‹ã‚’ä¸‹è¨˜ã«ç¤ºã—ã¾ã™ã€‚

- ãƒ‡ãƒã‚¤ã‚¹å´ã§åˆ©ç”¨ã§ãã‚‹API
  - åŠ é€Ÿåº¦ã‚„å¿ƒæ‹æ•°ãªã©ã®ã‚»ãƒ³ã‚µãƒ‡ãƒ¼ã‚¿ã®å–å¾—
  - ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿æ›¸ã
- ã‚³ãƒ³ãƒ‘ãƒ‹ã‚ªãƒ³å´ã§åˆ©ç”¨ã§ãã‚‹API
  - è¨­å®šã®èª­ã¿è¾¼ã¿
  - HTTPé€šä¿¡

ã‚³ãƒ³ãƒ‘ãƒ‹ã‚ªãƒ³å´ã®ã‚³ãƒ¼ãƒ‰ã¯ã‚ã£ã¦ã‚‚ãªãã¦ã‚‚è‰¯ã„ã®ã§ã€ã‚»ãƒ³ã‚µãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã‚„ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿æ›¸ãã ã‘ãŒå¿…è¦ãªå ´åˆã¯ã‚³ãƒ³ãƒ‘ãƒ‹ã‚ªãƒ³å´ã®ã‚³ãƒ¼ãƒ‰ã‚’ç„¡ãã—ã¦ãƒ‡ãƒã‚¤ã‚¹å´ã®ã‚³ãƒ¼ãƒ‰ã ã‘ã§ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ã§å‹•ã‹ã™ã“ã¨ãŒã§ãã¾ã™ã€‚ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä¸‹è¨˜ã«ç¤ºã—ã¾ã™ã€‚

```mermaid
flowchart TB
  subgraph ã‚¢ãƒ—ãƒª
    subgraph ãƒ‡ãƒã‚¤ã‚¹å´
      Sensor(ã‚»ãƒ³ã‚µãƒ‡ãƒ¼ã‚¿ã®å–å¾—)
      File(ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿æ›¸ã)
    end
  end
```

ä¸€æ–¹ã€è¨­å®šã®èª­ã¿è¾¼ã¿ã‚„HTTPé€šä¿¡ã‚‚å¿…è¦ãªå ´åˆã¯ã‚³ãƒ³ãƒ‘ãƒ‹ã‚ªãƒ³å´ã¨ãƒ‡ãƒã‚¤ã‚¹å´ã®ä¸¡æ–¹ã®ã‚³ãƒ¼ãƒ‰ãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚ã¾ãŸã€ã‚³ãƒ³ãƒ‘ãƒ‹ã‚ªãƒ³å´ã¨ãƒ‡ãƒã‚¤ã‚¹å´ã§é€šä¿¡ã‚’è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä¸‹è¨˜ã«ç¤ºã—ã¾ã™ã€‚

```mermaid
flowchart TB
  subgraph ã‚¢ãƒ—ãƒª
    subgraph ãƒ‡ãƒã‚¤ã‚¹å´
      Sensor(ã‚»ãƒ³ã‚µãƒ‡ãƒ¼ã‚¿ã®å–å¾—)
      File(ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿æ›¸ã)
    end
    subgraph ã‚³ãƒ³ãƒ‘ãƒ‹ã‚ªãƒ³å´
      Setting(è¨­å®šã®èª­ã¿æ›¸ã)
      Http(HTTPé€šä¿¡)
    end

    ãƒ‡ãƒã‚¤ã‚¹å´ <-->|é€šä¿¡| ã‚³ãƒ³ãƒ‘ãƒ‹ã‚ªãƒ³å´
  end
```

ä»Šå›ã®ã‚¢ãƒ—ãƒªã¯è¨­å®šã®èª­ã¿è¾¼ã¿ã‚„HTTPé€šä¿¡ã‚’å¿…è¦ã¨ã™ã‚‹ã‚‚ã®ã ã£ãŸã®ã§ã‚³ãƒ³ãƒ‘ãƒ‹ã‚ªãƒ³å´ã¨ãƒ‡ãƒã‚¤ã‚¹å´ã®ä¸¡æ–¹ã®ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’è¡Œã„ã¾ã—ãŸã€‚

### èµ·å‹•ã—ãŸã¾ã¾ã«ã™ã‚‹

Fitbitã‚¢ãƒ—ãƒªã¯æ“ä½œã—ãªã„çŠ¶æ…‹ãŒ2åˆ†é–“ä»¥ä¸Šç¶šãã¨è‡ªå‹•çš„ã«çµ‚äº†ã—ã¾ã™ã€‚ã“ã‚Œã‚’ç„¡åŠ¹åŒ–ã™ã‚‹ã«ã¯ãƒ‡ãƒã‚¤ã‚¹å´ã§[Appbit API](https://dev.fitbit.com/build/reference/device-api/appbit/)ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```js:app/index.js
import { me as appbit } from "appbit";
appbit.appTimeoutEnabled = false;
```

### è¨­å®šã®èª­ã¿è¾¼ã¿

Fitbitã‚¢ãƒ—ãƒªã«è¨­å®šæ©Ÿèƒ½ã‚’è¨­ã‘ã‚‹ã«ã¯ä¸‹è¨˜ã®4ã¤ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’è¡Œã„ã¾ã™ã€‚

1. è¨­å®šç”»é¢ã®ä½œæˆ
2. è¨­å®šãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
3. è¨­å®šãƒ‡ãƒ¼ã‚¿ã®é€ä¿¡
4. è¨­å®šãƒ‡ãƒ¼ã‚¿ã®å—ä¿¡

è¨­å®šç”»é¢ã‚’ä½œæˆã™ã‚‹ã«ã¯ã‚³ãƒ³ãƒ‘ãƒ‹ã‚ªãƒ³å´ã§Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¦ç™»éŒ²ã—ã¾ã™ã€‚ç™»éŒ²ã™ã‚‹ã«ã¯`registerSettingsPage`é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚

```js:settings/index.jsx
function HelloWorld(props) {
  return (
    <Page>
      <TextInput label="å¿ƒæ‹æ•°ãƒ‡ãƒ¼ã‚¿ã®ä¿æŒæœŸé–“[ç§’]" placeholder="ä¾‹ï¼š600" settingsKey="retentionPeriod" type="number"/>
      <TextInput label="é«˜ãƒªãƒ©ãƒƒã‚¯ã‚¹çŠ¶æ…‹ã®é–¾å€¤" placeholder="ä¾‹ï¼š1.2" settingsKey="thresholdHigh" type="number"/>
      <TextInput label="ä½ãƒªãƒ©ãƒƒã‚¯ã‚¹çŠ¶æ…‹ã®é–¾å€¤" placeholder="ä¾‹ï¼š0.8" settingsKey="thresholdLow" type="number"/>
      <Toggle settingsKey="sendHttp" label="ä½ãƒªãƒ©ãƒƒã‚¯ã‚¹æ¤œå‡ºæ™‚ã®HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡"/>
      <TextInput label="HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã®URL" placeholder="ä¾‹ï¼šhttps://example.com/api" settingsKey="sendUrl" type="url" disabled={!(props.settings.sendHttp === 'true')}/>
    </Page>
  );
}

registerSettingsPage(HelloWorld);
```

è¨­å®šãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€ã«ã¯ã‚³ãƒ³ãƒ‘ãƒ‹ã‚ªãƒ³å´ã§[Settings API](https://dev.fitbit.com/build/reference/companion-api/settings/)ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```js:companion/index.js
import { settingsStorage } from "settings";
const item = settingsStorage.getItem("myKey");
```

è¨­å®šãƒ‡ãƒ¼ã‚¿ã‚’ãƒ‡ãƒã‚¤ã‚¹å´ã¸é€ä¿¡ã™ã‚‹ã«ã¯ã‚³ãƒ³ãƒ‘ãƒ‹ã‚ªãƒ³å´ã§[Messaging API](https://dev.fitbit.com/build/reference/companion-api/messaging/)ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```js:companion/index.js
import { peerSocket } from "messaging";

if (peerSocket.readyState === peerSocket.OPEN) {
   peerSocket.send(data);
}
```

è¨­å®šãƒ‡ãƒ¼ã‚¿ã‚’å—ä¿¡ã™ã‚‹ã«ã¯ãƒ‡ãƒã‚¤ã‚¹å´ã§[Messaging API](https://dev.fitbit.com/build/reference/device-api/messaging/)ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```js:app/index.js
import { peerSocket } from "messaging";

messaging.peerSocket.addEventListener("message", onMessage);

function onMessage(event) {
  if (event && event.data) {
    console.log(event.data);
  }
}
```

### ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿æ›¸ã

Fitbitã‚¢ãƒ—ãƒªã§ã¯ä¾‹ãˆã°ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã®BluetoothãŒOFFã«ãªã£ã¦ã„ã‚‹ãªã©ã®ç†ç”±ã§ãƒ‡ãƒã‚¤ã‚¹ã¨ã‚³ãƒ³ãƒ‘ãƒ‹ã‚ªãƒ³ã®é–“ã§é€šä¿¡ã§ããªã„çŠ¶æ³ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®ã‚ˆã†ãªçŠ¶æ³ã§ã‚‚ã‚¢ãƒ—ãƒªã‚’å‹•ä½œå¯èƒ½ã«ã™ã‚‹ã«ã¯ã€è¨­å®šãƒ‡ãƒ¼ã‚¿ãªã©å‹•ä½œã«å¿…è¦ãªæƒ…å ±ã‚’ãƒ‡ãƒã‚¤ã‚¹å´ã§ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹æ–¹æ³•ãŒè€ƒãˆã‚‰ã‚Œã¾ã™ã€‚

ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿æ›¸ãã™ã‚‹ã«ã¯ãƒ‡ãƒã‚¤ã‚¹å´ã§[File System API](https://dev.fitbit.com/build/reference/device-api/fs/)ã‚’ä½¿ã„ã¾ã™ã€‚

```js:app/index.js
import * as fs from "fs";

function readSettings() {
  if (fs.existsSync("settings.json")) {
    return fs.readFileSync("settings.json", "json");
  }
}

function writeSettings(settings) {
  fs.writeFileSync("settings.json", settings, "json");
}
```

### å¿ƒæ‹æ•°ã®å–å¾—

å¿ƒæ‹æ•°ã‚’å–å¾—ã™ã‚‹ã«ã¯ãƒ‡ãƒã‚¤ã‚¹å´ã§[Heart-rate API](https://dev.fitbit.com/build/reference/device-api/heart-rate/)ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```js:app/index.js
import { HeartRateSensor } from "heart-rate";

const hrm = new HeartRateSensor({ frequency: 1 });
hrm.addEventListener("reading", onReading);
hrm.start();

function onReading() {
  const { heartRate } = hrm;

  if (!heartRate) {
    return;
  }

  console.log(heartRate);
}
```

Heart-rate APIã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯package.jsonã§ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```json:package.json
{
  "fitbit": {
    "requestedPermissions": [
      "access_heart_rate"
    ]
  }
}
```

### HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã®é€ä¿¡

HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ã«ã¯ã‚³ãƒ³ãƒ‘ãƒ‹ã‚ªãƒ³å´ã§[Fetch API](https://dev.fitbit.com/build/reference/companion-api/fetch/)ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```js:app/index.js
const response = fetch(url, {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
  },
  body: JSON.stringify({ heartRate: 80 }),
});
```

Fetch APIã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯package.jsonã§ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```json:package.json
{
  "fitbit": {
    "requestedPermissions": [
      "access_internet"
    ]
  }
}
```



## ãŠã‚ã‚Šã«

ã“ã®ã‚¢ãƒ—ãƒªã¯é•·å²¡æŠ€è¡“ç§‘å­¦å¤§å­¦ã®[æ°¸æ£®æ­£ä»](https://imse.nagaokaut.ac.jp/staff/masahito-nagamori)å…ˆç”Ÿã‚ˆã‚Šã‚¢ã‚¤ãƒ‡ã‚¢ã€çŸ¥è¦‹ã€ã”ä¾é ¼ã‚’ã„ãŸã ã„ã¦é–‹ç™ºã—ã¾ã—ãŸã€‚ç§ã¯é–‹ç™ºã‚’å—è¨—ã™ã‚‹æ™‚ã«ã¯åŸºæœ¬çš„ã«ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®è‘—ä½œè²¡ç”£æ¨©ã‚’ãŠå®¢ã•ã¾ã«ãŠè­²ã‚Šã—ã¦ã„ã‚‹ã®ã§ã€æœ¬æ¥ã§ã‚ã‚Œã°è‡ªåˆ†ã®åå‰ã§ã‚¢ãƒ—ãƒªã‚„ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ã‚’å…¬é–‹ã™ã‚‹æ¨©åˆ©ã¯ç„¡ã„ã®ã§ã™ãŒã€æ°¸æ£®å…ˆç”Ÿã¯ç§ã®å®Ÿç¸¾ã¨ã—ã¦å…¬é–‹ã™ã‚‹ã“ã¨ã‚’ã”å¿«è«¾ãã ã•ã„ã¾ã—ãŸã€‚ã“ã®å ´ã‚’å€Ÿã‚Šã¾ã—ã¦æ°¸æ£®å…ˆç”Ÿã®ã”åšæ„ã«æ·±ãæ„Ÿè¬ã‚’ç”³ã—ä¸Šã’ã¾ã™ã€‚
