---
title: "Node.jsã§Basicèªè¨¼ã‚’è¨­å®šã™ã‚‹æ–¹æ³•ã€å‹•ç”»ç‰ˆã‚ã‚Šã€‘"
emoji: "ðŸ˜€"
type: "tech"
topics: ["nodejs", "auth"]
published: true
---

# ã¯ã˜ã‚ã«

ã“ã®è¨˜äº‹ã§ã¯Node.jsã§Basicèªè¨¼ã‚’è¡Œã†æ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜Žã—ã¾ã™ã€‚èª¬æ˜Žã«ã‚ãŸã‚Šã€ä¸‹è¨˜4ã¤ã®ã‚±ãƒ¼ã‚¹ã‚’æƒ³å®šã—ã¾ã™ã€‚

- Expressã‚’ä½¿ã„ã€npmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã†ã‚±ãƒ¼ã‚¹
- Expressã‚’ä½¿ã„ã€npmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã‚ãªã„ã‚±ãƒ¼ã‚¹
- Expressã‚’ä½¿ã‚ãšã€npmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã†ã‚±ãƒ¼ã‚¹
- Expressã‚’ä½¿ã‚ãšã€npmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã‚ãªã„ã‚±ãƒ¼ã‚¹

é–¢é€£ãƒªãƒ³ã‚¯ã‚’ä¸‹è¨˜ã«ç¤ºã—ã¾ã™ã€‚

- [ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰](https://gist.github.com/tatsuyasusukida/0a5efa57daa27cb9ab04bab01f8b789f)
- [å‹•ç”»ç‰ˆ](https://www.youtube.com/watch?v=-FrAzwDwjd4)

https://www.youtube.com/watch?v=-FrAzwDwjd4



# ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®æº–å‚™

ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ä¸‹è¨˜ã®ã‚³ãƒžãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®æº–å‚™ã‚’ã—ã¾ã™ã€‚

```shell
mkdir nodejs-basic-auth
cd nodejs-basic-auth
npm init -y
npm install --save express basic-auth-connect basic-auth
touch case-01.js case-02.js case-03.js case-04.js
```



# ã‚±ãƒ¼ã‚¹1:Expressã‚’ä½¿ã„ã€npmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã†ã‚±ãƒ¼ã‚¹

case-01.jsã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ä¸‹è¨˜ã«ç¤ºã—ã¾ã™ã€‚

@[gist](https://gist.github.com/tatsuyasusukida/0a5efa57daa27cb9ab04bab01f8b789f?file=case-01.js)

ä¸Šè¨˜ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§ã¯ [basic-auth-connect](https://www.npmjs.com/package/basic-auth-connect) ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ãŒã€npmã®ãƒšãƒ¼ã‚¸ã«æ›¸ã‹ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«ã“ã®npmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯éžæŽ¨å¥¨æ‰±ã„ãªã®ã§ [basic-auth](https://www.npmjs.com/package/basic-auth) ãªã©ã‚’ä½¿ã£ã¦ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’è‡ªä½œã™ã‚‹ã“ã¨ãŒæŽ¨å¥¨ã•ã‚Œã¦ã„ã¾ã™ã€‚ä»£æ›¿ã™ã‚‹npmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦ã¯ [express-basic-auth](https://www.npmjs.com/package/express-basic-auth) ãªã©ãŒå€™è£œã¨ã—ã¦æŒ™ã’ã‚‰ã‚Œã¾ã™ã€‚

## å‹•ä½œç¢ºèªã®æ–¹æ³•

ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ä¸‹è¨˜ã®ã‚³ãƒžãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦Webã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¾ã™ã€‚

```shell
node case-01.js
```

ç¶šã„ã¦æ–°è¦ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’èµ·å‹•ã—ã¦ã‹ã‚‰ä¸‹è¨˜ã®ã‚³ãƒžãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦èªè¨¼æƒ…å ±ãªã—ã§ã¯ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚

```shell
curl -v http://localhost:3000/
```

ä¸Šè¨˜ã®ã‚³ãƒžãƒ³ãƒ‰ã®å®Ÿè¡Œçµæžœã‚’ä¸‹è¨˜ã«ç¤ºã—ã¾ã™ã€‚

```
*   Trying ::1:3000...
* Connected to localhost (::1) port 3000 (#0)
> GET / HTTP/1.1
> Host: localhost:3000
> User-Agent: curl/7.77.0
> Accept: */*
> 
* Mark bundle as not supporting multiuse
< HTTP/1.1 401 Unauthorized
< X-Powered-By: Express
< WWW-Authenticate: Basic realm="Authorization Required"
< Date: Mon, 02 May 2022 02:15:20 GMT
< Connection: keep-alive
< Keep-Alive: timeout=5
< Content-Length: 12
< 
* Connection #0 to host localhost left intact
Unauthorized
```

ç¶šã„ã¦ä¸‹è¨˜ã®ã‚³ãƒžãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦èªè¨¼æƒ…å ±ã‚ã‚Šã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚

```shell
curl -v http://username:password@localhost:3000/
```

ä¸Šè¨˜ã®ã‚³ãƒžãƒ³ãƒ‰ã®å®Ÿè¡Œçµæžœã‚’ä¸‹è¨˜ã«ç¤ºã—ã¾ã™ã€‚

```
*   Trying ::1:3000...
* Connected to localhost (::1) port 3000 (#0)
* Server auth using Basic with user 'username'
> GET / HTTP/1.1
> Host: localhost:3000
> Authorization: Basic dXNlcm5hbWU6cGFzc3dvcmQ=
> User-Agent: curl/7.77.0
> Accept: */*
> 
* Mark bundle as not supporting multiuse
< HTTP/1.1 200 OK
< X-Powered-By: Express
< Content-Type: application/json; charset=utf-8
< Content-Length: 11
< ETag: W/"b-Ai2R8hgEarLmHKwesT1qcY913ys"
< Date: Mon, 02 May 2022 02:15:55 GMT
< Connection: keep-alive
< Keep-Alive: timeout=5
< 
* Connection #0 to host localhost left intact
{"ok":true}
```



# ã‚±ãƒ¼ã‚¹2:Expressã‚’ä½¿ã„ã€npmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã‚ãªã„ã‚±ãƒ¼ã‚¹

case-02.jsã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ä¸‹è¨˜ã«ç¤ºã—ã¾ã™ã€‚

@[gist](https://gist.github.com/tatsuyasusukida/0a5efa57daa27cb9ab04bab01f8b789f?file=case-02.js)

ãƒã‚¤ãƒ³ãƒˆã‚’ä¸‹è¨˜ã«ç¤ºã—ã¾ã™ã€‚

1. Authorizationãƒ˜ãƒƒãƒ€ã®æœ‰ç„¡ã‚’ç¢ºèªã—ã¦ã„ã¾ã™ã€‚
2. Authorizationãƒ˜ãƒƒãƒ€ã‚’è§£æžã—ã¦ã„ã¾ã™ã€‚
3. èªè¨¼æ–¹å¼ãŒ"Basic"ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ã„ã¾ã™ã€‚
4. ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ã¦ã„ã¾ã™ã€‚
5. èªè¨¼ãŒæˆåŠŸã—ãŸå ´åˆã¯æ¬¡ã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã¸é€²ã¿ã¾ã™ã€‚
6. èªè¨¼ãŒå¤±æ•—ã—ãŸå ´åˆã¯401(Unauthorized)å¿œç­”ã‚’è¿”ã—ã¾ã™ã€‚

å‹•ä½œç¢ºèªã®æ–¹æ³•ã«ã¤ã„ã¦ã¯ã‚±ãƒ¼ã‚¹1ã¨åŒæ§˜ã§ã™ã®ã§å‰²æ„›ã—ã¾ã™ã€‚



# ã‚±ãƒ¼ã‚¹3:Expressã‚’ä½¿ã‚ãšã€npmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã†ã‚±ãƒ¼ã‚¹

case-03.jsã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ä¸‹è¨˜ã«ç¤ºã—ã¾ã™ã€‚

@[gist](https://gist.github.com/tatsuyasusukida/0a5efa57daa27cb9ab04bab01f8b789f?file=case-03.js)

ä¸Šè¨˜ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§ã¯ [basic-auth](https://www.npmjs.com/package/basic-auth) ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚
ã“ã®npmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ä¸‹è¨˜3ç‚¹ã®å‡¦ç†ã‚’è‡ªåˆ†ã§å®Ÿè£…ã™ã‚‹å¿…è¦ãŒç„¡ããªã‚Šã¾ã™ã€‚

- Authorizationãƒ˜ãƒƒãƒ€ã®æœ‰ç„¡ã®ç¢ºèª
- Authorizationãƒ˜ãƒƒãƒ€ã®è§£æž
- èªè¨¼æ–¹å¼ãŒ"Basic"ã§ã‚ã‚‹ã“ã¨ã®ç¢ºèª

å‹•ä½œç¢ºèªã®æ–¹æ³•ã«ã¤ã„ã¦ã¯ã‚±ãƒ¼ã‚¹1ã¨åŒæ§˜ã§ã™ã®ã§å‰²æ„›ã—ã¾ã™ã€‚



# ã‚±ãƒ¼ã‚¹4:Expressã‚’ä½¿ã‚ãšã€npmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã‚ãªã„ã‚±ãƒ¼ã‚¹

case-04.jsã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ä¸‹è¨˜ã«ç¤ºã—ã¾ã™ã€‚

@[gist](https://gist.github.com/tatsuyasusukida/0a5efa57daa27cb9ab04bab01f8b789f?file=case-04.js)

å†…å®¹ã¯ã‚±ãƒ¼ã‚¹3ã¨ã‚±ãƒ¼ã‚¹4ã¨åˆã‚ã›æŠ€ã§ã™ã€‚å‹•ä½œç¢ºèªã®æ–¹æ³•ã«ã¤ã„ã¦ã¯ã‚±ãƒ¼ã‚¹1ã¨åŒæ§˜ã§ã™ã®ã§å‰²æ„›ã—ã¾ã™ã€‚



# ãŠã‚ã‚Šã«

ã©ã®æ–¹æ³•ã§ã‚‚Basicèªè¨¼ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ãŒã€Expressã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã¯ [basic-auth-connect](https://www.npmjs.com/package/basic-auth-connect) ã‚„ [express-basic-auth](https://www.npmjs.com/package/express-basic-auth) ã‚’ä½¿ã„ã€Expressã‚’åˆ©ç”¨ã—ãªã„å ´åˆã¯ [basic-auth](https://www.npmjs.com/package/basic-auth) ã‚’ä½¿ã†ã‚±ãƒ¼ã‚¹ãŒå¤šã„ã®ã§ã¯ãªã„ã‹ã¨æ€ã„ã¾ã™ã€‚

ç§ã¯Expressã‚’åˆ©ç”¨ã—ã¦ãŠã‚Šæ™®æ®µã¯ basic-auth-connect ã‚’ä½¿ã£ã¦ã„ã¾ã™ãŒã€è¨˜äº‹ã‚’æ›¸ããŸã‚ã«è‰²ã€…ã¨èª¿ã¹ã¦ä»Šå¾Œã¯ express-basic-auth ã‚’ä½¿ãŠã†ã¨æ€ã„ã¾ã—ãŸã€‚

ã„ã¾ã ã«ä½•ã‹ã¨å¿…è¦ã¨ãªã‚‹å ´é¢ã®å¤šã„Basicèªè¨¼ã§ã™ãŒã€è‰²ã€…ãªæ–¹æ³•ãŒã‚ã‚‹ä¸­ã§ã©ã®æ–¹æ³•ã‚’é¸ã¹ã°è‰¯ã„ã‹ã‚’æ±ºã‚ã‚‹ãŸã‚ã®å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚ã¾ãŸã€ãŠæ°—ã¥ãã®ç‚¹ãªã©ã‚ã‚Šã¾ã—ãŸã‚‰ãŠæ°—è»½ã«ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã„ãŸã ã‘ã‚Œã°å¹¸ã„ã§ã™ã€‚æœ€å¾Œã¾ã§ãŠèª­ã¿ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼

